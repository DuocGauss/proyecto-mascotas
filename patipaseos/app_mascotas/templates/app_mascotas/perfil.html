{% extends "app_mascotas/base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Perfil del Usuario{% endblock %}

{% block content %}

{% if messages %}
    {% for msg in messages %}
       <script>
           Swal.fire({
               title: 'Exito!',
               text: '{{msg}}',
               icon: 'success',
               confirmButtonText: 'Aceptar',
               confirmButtonColor: 'Green'
           });
       </script>
    {% endfor %}
{% endif %}

<script>
    function eliminarServicio(id_servicio) {
        Swal.fire({
            title: 'Alerta',
            text: 'Está a punto de eliminar un servicio publicado',
            icon: 'warning',
            confirmButtonText: 'Continuar',
            confirmButtonColor: 'Red',
            showCancelButton: true,
            cancelButtonText: 'Cancelar'
        }).then(function(resp) {
            if (resp.isConfirmed) {
                // Realizar una solicitud AJAX al servidor para eliminar el registro
                $.ajax({
                    url: "/eliminar_servicio/" + id_servicio,
                    method: "POST", // O "DELETE" si prefieres utilizar el método DELETE
                    data: {
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function(data) {
                        // Eliminar la fila de la tabla HTML
                        $('#servicio-' + id_servicio).remove();
                        // Mostrar un mensaje de éxito
                        Swal.fire({
                            title: 'Éxito',
                            text: 'Servicio eliminado con éxito',
                            icon: 'success',
                            confirmButtonText: 'Aceptar',
                            confirmButtonColor: 'Green'
                        }).then(function() {
                            // Redirigir a la página de gestión de tareas
                            window.location.href = "{% url 'perfil' %}";
                        });
                    },
                    error: function(data) {
                        // Manejar errores si es necesario
                        console.error('Error al eliminar el servicio');
                    }
                });
            }
        });
    }
    </script>

    <script>
        function eliminarMascota(id_mascota) {
            Swal.fire({
                title: 'Alerta',
                text: 'Está a punto de eliminar una mascota',
                icon: 'warning',
                confirmButtonText: 'Continuar',
                confirmButtonColor: 'Red',
                showCancelButton: true,
                cancelButtonText: 'Cancelar'
            }).then(function(resp) {
                if (resp.isConfirmed) {
                    // Realizar una solicitud AJAX al servidor para eliminar el registro
                    $.ajax({
                        url: "/eliminar_mascota/" + id_mascota,
                        method: "POST", // O "DELETE" si prefieres utilizar el método DELETE
                        data: {
                            csrfmiddlewaretoken: '{{ csrf_token }}'
                        },
                        success: function(data) {
                            // Eliminar la fila de la tabla HTML
                            $('#mascota-' + id_mascota).remove();
                            // Mostrar un mensaje de éxito
                            Swal.fire({
                                title: 'Éxito',
                                text: 'Mascota eliminada con éxito',
                                icon: 'success',
                                confirmButtonText: 'Aceptar',
                                confirmButtonColor: 'Green'
                            }).then(function() {
                                // Redirigir a la página de gestión de tareas
                                window.location.href = "{% url 'perfil' %}";
                            });
                        },
                        error: function(data) {
                            // Manejar errores si es necesario
                            console.error('Error al eliminar la mascota');
                        }
                    });
                }
            });
        }
        </script>

<div class="page-content page-container" id="page-content">
    <div class="padding">
        <div class="row container d-flex justify-content-center">
            <div class="col-xl-6 col-md-12">
                <div class="card user-card-full">
                    <div class="row m-l-0 m-r-0">
                        <div class="col-sm-4 bg-c-lite-green user-profile">
                            <div class="card-block text-center text-white">
                                <div class="m-b-25">
                                    {% if data.imagen %}
                                        <img src="{{ data.imagen.url }}" class="circle responsive-img" alt="User-Profile-Image">
                                        <button class="btn btn-info m-t-10" onclick="editProfileImage()"><i class="fas fa-edit"></i></button>
                                    {% else %}
                                        <img src="{% static 'img/no_avatar.jpg' %}" class="img-radius" alt="User-Profile-Image">
                                        <button class="btn btn-success m-t-10" onclick="addProfileImage()">Agregar Foto</button>
                                    {% endif %}
                                </div>
                                <h6 class="f-w-600">{{ data.first_name }} {{ data.last_name }}</h6>
                                <p>{{ cuidador_data.especializacion|default:"Usuario normal" }}</p>
                                <i class=" mdi mdi-square-edit-outline feather icon-edit m-t-10 f-16"></i>
                            </div>
                        </div>
                        <div class="col-sm-8">
                            <div class="card-block">
                                <h6 class="m-b-20 p-b-5 b-b-default f-w-600">Información</h6>
                                <div class="row">
                                    <div class="col-sm-6">
                                        <p class="m-b-10 f-w-600">Nombre de usuario</p>
                                        <h6 class="text-muted f-w-400">{{ data.username }}</h6>
                                    </div>
                                    <div class="col-sm-6">
                                        <p class="m-b-10 f-w-600">Email</p>
                                        <h6 class="text-muted f-w-400">{{ data.email }}</h6>
                                    </div>
                                </div>
                                <!-- Agrega más información según tus necesidades -->
                                <h6 class="m-b-20 m-t-40 p-b-5 b-b-default f-w-600">Datos adicionales</h6>
                                <div class="row">
                                    <div class="col-sm-6">
                                        <p class="m-b-10 f-w-600">Dirección</p>
                                        <h6 class="text-muted f-w-400">{{data.direccion}}</h6>
                                    </div>
                                    <div class="col-sm-6">
                                        <p class="m-b-10 f-w-600">Número Teléfonico</p>
                                        <h6 class="text-muted f-w-400">{{data.telefono}}</h6>
                                    </div>
                                    {% if cuidador_data.experiencia %}
                                    <div class="col-sm-12">
                                        <p class="m-b-10 f-w-600">Experiencia</p>
                                        <h6 class="text-muted f-w-400">{{cuidador_data.experiencia}}</h6>
                                    </div>
                                    {% endif %}
                                </div>
                                <!-- Puedes personalizar esto según tus necesidades -->
                                <ul class="social-link list-unstyled m-t-40 m-b-10">
                                    <!-- Añade tus enlaces sociales aquí -->
                                     <a href="{% url 'editar_perfil' data.id %}" class="btn btn-primary">Editar perfil 
                                        <i class="fas fa-edit"></i>
                                    </a>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <a class="btn btn-primary" data-toggle="modal" data-target="#agregarMascotaModal">
                    Agregar Mascota <i class="fas fa-plus"></i>
                </a>                
            </div>
        </div>
    </div>

    {% if mascotas_usuario %}
    <h2>Mis Mascotas</h2>
    <div class="row">
        {% for mascota in mascotas_usuario %}
            <div class="col-md-4">
                <div class="card d-flex">
                    <div class="ml-auto mt-2">
                        <a class="btn" href="{% url "modificar_mascota" mascota.id_mascota %}">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a class="btn" onclick="eliminarMascota({{ mascota.id_mascota }})">
                            <i class="fas fa-times"></i>
                        </a>
                    </div>
                    <div class="card-body">
                        <!-- Agrega un espacio para la foto de la mascota -->
                        {% if mascota.imagen %}
                            <img src="{{ mascota.imagen.url }}" class="img-fluid rounded" style="max-height: 150px;" alt="Foto de la Mascota">
                        {% else %}
                            <img src="{% static 'app_mascotas/img/no_pet.png' %}" class="img-fluid rounded" style="max-height: 150px;" alt="Foto de la Mascota por Defecto">
                        {% endif %}
                        
                        <h5 class="card-title">{{ mascota.nombre_mascota }}</h5>
                        <p class="card-text"><strong>Tipo:</strong> {{ mascota.tipo_mascota }}</p>
                        <p class="card-text"><strong>Tamaño:</strong> {{ mascota.tamaño_mascota }}</p>
                        {% if not mascota.raza_mascota %}
                            <p></p>
                        {% else %}
                            <p class="card-text"><strong>Raza:</strong> {{ mascota.raza_mascota }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% endif %}





    {% if cuidador_data %}
    <div class="col-md-12">
        <h1>Servicios Publicados:</h1>
    </div>
    <div class="card-group">
        {% for servicio in servicios %}
            <div class="card">
                <!-- Puedes personalizar la presentación de cada servicio aquí -->
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <h5 class="card-title">{{ servicio.tipo_servicio }}</h5>
                        <div class="btn-group">
                            <a class="btn" href="{% url "modificar_servicio" servicio.id_servicio %}">
                                <i class="fas fa-edit"></i> 
                            </a>
                            <a class="btn" onclick="eliminarServicio({{ servicio.id_servicio }})">
                                <i class="fas fa-times"></i> 
                            </a>
                        </div>
                    </div>
                    <p class="card-text">{{ servicio.descripcion }}</p>
                    <p class="card-text"><small class="text-muted">Precio: ${{ servicio.precio }}</small></p>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <div class="col-md-12">
        <p></p>
    </div>
{% endif %}

<script>
$('#agregarMascotaModal').on('show.bs.modal', function (event) {
    var modal = $(this);
    modal.find('.modal-title').text('Agregar Mascota');
    modal.find('.modal-body input').val('');
});
</script>

<div class="modal fade" id="agregarMascotaModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Agregar Mascota</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'perfil' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ form_mascota|crispy }}
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </form>
            </div>
        </div>
    </div>
</div>

 

</div>



{% endblock %}
